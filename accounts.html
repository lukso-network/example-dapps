<html>

<head>
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.3/milligram.min.css">
  <link rel="stylesheet/less" type="text/css" href="styles.less" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js"></script>
</head>

<body class="container" style="padding-top: 3%;">
  <p><a href="index.html">Back to Landing Page</a></p>
  <h2>Account dApp</h2>
  <!-- Extension Notice -->
  <p class="note" style="display: block;">If you have multiple Web3 extensions installed, make sure to only enable one.
    Here
    you can find guides to manage
    <a href="https://support.google.com/chrome_webstore/answer/2664769?hl=en" target="_blank">Chrome</a> and
    <a href="https://support.mozilla.org/en-US/kb/disable-or-remove-add-ons#w_disabling-and-removing-extensions"
      target="_blank">Firefox</a> extensions.
  </p>

  <!-- Warnings -->
  <div class="warning" id="extension">
    MetaMask detected. To ensure the best expirience, install the
    <a href="https://docs.lukso.tech/guides/universal-profile/browser-extension/install-browser-extension">Universal
      Profile Browser Extension</a> from LUKSO.
  </div>
  <p id="browser" class="warning">Please switch to a
    <a href="https://www.google.com/chrome/" target="_blank">Chrome</a> or
    <a href="https://www.mozilla.org/firefox/new/" target="_blank">Firefox</a> browser to use this dApp.
  </p>
  <p id="network" class="warning">
    Please <a href="https://docs.lukso.tech/networks/l14-testnet">swap to the LUKSO L14 testnetwork</a> in order to see
    your account balance.
  </p>
  <p id="install" class="warning">
    Please install the
    <a href="https://docs.lukso.tech/guides/universal-profile/browser-extension/install-browser-extension"
      target="_blank">Universal Profile</a> or
    <a href="https://metamask.io/" target="_blank">MetaMask</a> extension to login.
  </p>
  <div id="login" style="display: none">
    <button id="loginbutton">Log in to your browser extension</button>
  </div>

  <hr />

  <!-- dApp Frontend-->
  <table>
    <thead>
      <tr>
        <th>Address</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody id="accounts">
      <tr>
        <td colspan="2">Trying to load your accounts...</td>
      </tr>
    </tbody>
  </table>

  <hr />

  <b style="padding-bottom: 50px ">Repository File:</b></br><a
    href="https://github.com/lukso-network/example-dapps-ethjs/blob/master/accounts.html"
    target="_blank">lukso-network/example-dapps-ethjs/accounts.html</a>

  <!-- Web3 -->
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

  <!-- Connect Extension & Check Network -->
  <script src="./utils.js"></script>

  <!-- Main Function -->
  <script type="text/javascript">
    let el = function (id) { return document.querySelector(id); };

    // dApp Functionality
    async function dApp() {

      /**
       * Only start the dApp if an extension is installed and right network connected 
       * Functions can be found in utils.js and return bool
       */
      if (await connectWeb3() && await checkNetwork()) {
        const web3 = new Web3(window.ethereum);
        let accounts = await ethereum.request({ method: "eth_accounts" });

        // After receiving the account, clear the loading info
        el('#accounts').innerHTML = '';

        /**
         * Show the address with balance within the table.
         * Might return multiple accounts on 3rd party extensions
         */
        for (var i = 0; i < accounts.length; i++) {
          el('#accounts').innerHTML += '<tr><td>'
            + accounts[i] + '</td><td id="accountBalance_'
            + accounts[i] + '"></td></tr>';
          el('#accountBalance_' + accounts[i]).innerHTML += web3.utils.fromWei(await web3.eth.getBalance(accounts[i]), 'ether')
            + ' LYXt';
        }
      }
    };

    // Start the dApp function
    dApp();
  </script>
</body>

</html>