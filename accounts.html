<html>

<head>
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.3/milligram.min.css">
  <link rel="stylesheet/less" type="text/css" href="styles.less" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js"></script>
</head>

<body class="container" style="padding-top: 3%;">
  <p><a href="index.html">Back to Landing Page</a></p>
  <h2>Account dApp</h2>
  <!-- Extension Notice -->
  <p class="note" style="display: block;">If you have multiple Web3 extensions installed, make sure to only enable one.
    Here
    you can find guides to manage
    <a href="https://support.google.com/chrome_webstore/answer/2664769?hl=en" target="_blank">Chrome</a> and
    <a href="https://support.mozilla.org/en-US/kb/disable-or-remove-add-ons#w_disabling-and-removing-extensions"
      target="_blank">Firefox</a> extensions.
  </p>

  <!-- Warnings -->
  <div class="warning" id="extension">
    MetaMask detected. To ensure the best expirience, install the
    <a href="https://docs.lukso.tech/guides/universal-profile/browser-extension/install-browser-extension">Universal
      Profile Browser Extension</a> from LUKSO.
  </div>
  <p id="browser" class="warning">Please switch to a
    <a href="https://www.google.com/chrome/" target="_blank">Chrome</a> or
    <a href="https://www.mozilla.org/firefox/new/" target="_blank">Firefox</a> browser to use this dApp.
  </p>
  <p id="network" class="warning">
    Please <a href="https://docs.lukso.tech/networks/l14-testnet">swap to the LUKSO L14 testnetwork</a> in order to see
    your account balance.
  </p>
  <p id="install" class="warning">
    Please install the
    <a href="https://docs.lukso.tech/guides/universal-profile/browser-extension/install-browser-extension"
      target="_blank">Universal Profile</a> or
    <a href="https://metamask.io/" target="_blank">MetaMask</a> extension to login.
  </p>
  <div id="login" style="display: none">
    <button id="loginbutton">Log in to your browser extension</button>
  </div>

  <hr />

  <!-- dApp Frontend-->
  <table>
    <thead>
      <tr>
        <th>Address</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody id="accounts">
      <tr>
        <td colspan="2">Trying to load your accounts...</td>
      </tr>
    </tbody>
  </table>

  <script type="text/javascript" src="ethereumjs-testrpc.js"></script>
  <script type="text/javascript" src="ethjs.js"></script>

  <!-- Main Function -->
  <script type="text/javascript">
    var eth = new Eth(TestRPC.provider());
    var el = function (id) { return document.querySelector(id); };

    /*
    // uncomment to enable MetaMask support:
    if (typeof window.web3 !== 'undefined' && typeof window.web3.currentProvider !== 'undefined') {
      eth.setProvider(window.web3.currentProvider);
    } else {
      eth.setProvider(provider); // set to TestRPC if not available
    }
    */

    eth.accounts(function (accountsError, accounts) {
      if (accountsError) {
        el('#accounts').innerHTML = 'Hmm.. looks like there was an error: '
          + String(accountsError);
      }

      el('#accounts').innerHTML = '';

      accounts.forEach(function (account) {
        el('#accounts').innerHTML += '<tr><td>'
          + account + '</td><td id="accountBalance_'
          + account + '"></td></tr>';

        eth.getBalance(account, function (balanceError, balance) {
          el('#accountBalance_' + account).innerHTML += Eth.fromWei(balance, 'ether')
            + ' ether';
        });
      });
    });
  </script>
</body>

</html>